<div class="card">
  <div class="chart-header">
    <button class="btn btn-secondary" (click)="previousMonth()">â€¹ Anterior</button>
    <h2>{{ getMonthName() }}</h2>
    <button class="btn btn-secondary" (click)="nextMonth()">Seguinte â€º</button>
  </div>

  <div class="chart-container" *ngIf="records$ | async as records">
    <div class="chart-legend">
      <div class="legend-item">
        <span class="legend-color" style="background-color: #dc3545;"></span>
        <span>Dias com fluxo menstrual</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background-color: #28a745;"></span>
        <span>Dias infÃ©rteis secos</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background-color: #ffffff; border: 2px solid #666;"></span>
        <span>Dias de muco</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background-color: #28a745;"></span>
        <span class="baby-symbol">ðŸ‘¶</span>
        <span>Dias secos mas fÃ©rteis</span>
      </div>
    </div>

    <div class="calendar-grid">
      <div class="calendar-header">
        <div class="day-header">Data</div>
        <div class="day-header">Cor</div>
        <div class="day-header">CÃ³digos</div>
        <div class="day-header">Notas</div>
      </div>

      <div *ngFor="let day of generateCalendarDays()" class="calendar-row">
        <div class="date-cell">
          {{ formatDate(day) }}
        </div>

        <ng-container *ngIf="getRecordForDate(getCurrentMonthRecords(records), day) as dayRecord; else emptyDay">
          <div class="color-cell"
               [style.background-color]="dayRecord.chartColor"
               [style.color]="getTextColor(dayRecord.chartColor)"
               [style.border]="dayRecord.chartColor === '#ffffff' ? '2px solid #666' : 'none'">
            {{ dayRecord.chartSymbol }}
            <span *ngIf="dayRecord.baby" class="baby-symbol">ðŸ‘¶</span>
            <span *ngIf="dayRecord.peakDay" class="peak-indicator">P</span>
            <span *ngIf="dayRecord.postPeakDay" class="post-peak-indicator">{{ dayRecord.postPeakDay }}</span>
          </div>
          <div class="codes-cell">
            {{ getCreightonCodes(dayRecord) }}
          </div>
          <div class="notes-cell" [innerHTML]="getUserNotes(dayRecord)">
          </div>
        </ng-container>

        <ng-template #emptyDay>
          <div class="color-cell empty">-</div>
          <div class="codes-cell">-</div>
          <div class="notes-cell">-</div>
        </ng-template>
      </div>
    </div>
  </div>
</div>